<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Browser-based PSHA Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
    }
    input, select, button {
      margin: 5px 0;
      padding: 5px;
    }
    #output {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 20px;
      background: #f9f9f9;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Probabilistic Seismic Hazard Analysis (PSHA)</h1>
    <p>
      Load your source model (a JSON file with fault data), select a GMPE and USGS seismic catalog, and run the PSHA calculation.
    </p>
    
    <!-- File input for the source model -->
    <label for="sourceModelFile">Source Model File (JSON):</label><br>
    <input type="file" id="sourceModelFile" accept=".json"><br><br>
    
    <!-- Select input for GMPE -->
    <label for="gmpeSelect">Select GMPE:</label><br>
    <select id="gmpeSelect">
      <option value="gmpe1">GMPE 1</option>
      <option value="gmpe2">GMPE 2</option>
      <option value="gmpe3">GMPE 3</option>
    </select><br><br>
    
    <!-- Select input for USGS seismic catalog -->
    <label for="catalogSelect">Select USGS Seismic Catalog:</label><br>
    <select id="catalogSelect">
      <option value="catalog1">USGS Catalog 1</option>
      <option value="catalog2">USGS Catalog 2</option>
    </select><br><br>
    
    <button id="calculateBtn">Calculate PSHA</button>
    
    <div id="output">
      <h2>Results</h2>
      <div id="resultText">No results yet.</div>
    </div>
  </div>
  
  <script>
    // ------------------------------------------
    // Dummy GMPE functions (replace with real equations)
    // ------------------------------------------
    function gmpe1(magnitude, distance, fault) {
      return Math.exp(0.5 * magnitude - 0.03 * distance);
    }
    
    function gmpe2(magnitude, distance, fault) {
      return Math.exp(0.45 * magnitude - 0.035 * distance);
    }
    
    function gmpe3(magnitude, distance, fault) {
      return Math.exp(0.55 * magnitude - 0.025 * distance);
    }
    
    const gmpeFunctions = {
      gmpe1: gmpe1,
      gmpe2: gmpe2,
      gmpe3: gmpe3
    };
    
    // ------------------------------------------
    // Dummy USGS catalog parameters (replace with real parameters)
    // ------------------------------------------
    const usgsCatalogs = {
      catalog1: {
        description: "USGS Catalog 1",
        bValue: 1.0,
        recurrenceFactor: 1.0
      },
      catalog2: {
        description: "USGS Catalog 2",
        bValue: 0.9,
        recurrenceFactor: 1.2
      }
    };
    
    let sourceModel = null;
    
    document.getElementById('sourceModelFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          sourceModel = JSON.parse(e.target.result);
          document.getElementById('resultText').textContent = "Source model loaded successfully.\n";
        } catch (error) {
          document.getElementById('resultText').textContent = "Error parsing source model: " + error;
        }
      };
      reader.readAsText(file);
    });
    
    function calculatePSHA(sourceModel, gmpeFunc, catalogParams) {
      let results = "";
      if (!sourceModel || !sourceModel.faults) {
        return "Invalid source model. Please check your file.";
      }
      sourceModel.faults.forEach(function(fault) {
        const magnitude = fault.magnitude || 6.5;
        const distance = fault.distance || 10;
        const groundMotion = gmpeFunc(magnitude, distance, fault);
        const annualRate = catalogParams.recurrenceFactor * Math.pow(10, -catalogParams.bValue * magnitude);
        results += "Fault: " + (fault.FaultID || "Unknown") + "\n";
        results += "  Magnitude: " + magnitude.toFixed(2) + "\n";
        results += "  Distance: " + distance.toFixed(2) + " km\n";
        results += "  GMPE (" + gmpeFunc.name + ") Ground Motion: " + groundMotion.toFixed(4) + "\n";
        results += "  Annual Occurrence Rate: " + annualRate.toExponential(2) + "\n\n";
      });
      return results;
    }
    
    document.getElementById('calculateBtn').addEventListener('click', function() {
      if (!sourceModel) {
        document.getElementById('resultText').textContent = "Please load a source model file first.";
        return;
      }
      const selectedGMPE = document.getElementById('gmpeSelect').value;
      const selectedCatalog = document.getElementById('catalogSelect').value;
      const gmpeFunc = gmpeFunctions[selectedGMPE];
      const catalogParams = usgsCatalogs[selectedCatalog];
      const results = calculatePSHA(sourceModel, gmpeFunc, catalogParams);
      document.getElementById('resultText').textContent = results;
    });
  </script>
</body>
</html>
